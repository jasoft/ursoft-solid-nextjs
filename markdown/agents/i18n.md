# Next.js App Router 多语言 + 静态生成（SSG/export）实现摘要

下面是 Next.js App Router 多语言 + 静态生成（SSG/export） 的实现摘要，按“给编码 AI”的可执行要点写。

## 目标

- URL 级多语言：`/zh/...`、`/en/...`
- 每个 locale 预渲染静态页面 (`generateStaticParams`)
- 构建输出纯静态站点 (`output: "export"`)
- 字典按语言拆分（JSON 或 TS），页面/布局按 locale 加载

## 目录结构

```text
app/
  [locale]/
    layout.tsx
    page.tsx
    about/page.tsx
lib/
  i18n.ts
i18n.ts
messages/
  zh.json
  en.json
next.config.js
```

## 1. 定义 locale 常量

`i18n.ts`

```typescript
export const locales = ["zh", "en"] as const;
export type Locale = (typeof locales)[number];
export const defaultLocale: Locale = "zh";
```

## 2. 字典加载函数（动态 import）

`lib/i18n.ts`

```typescript
import type { Locale } from "@/i18n";

export async function getMessages(locale: Locale) {
  return (await import(`@/messages/${locale}.json`)).default as any;
}
```

## 3. [locale] 布局：静态参数 + 设置 `<html lang>`

`app/[locale]/layout.tsx`

```tsx
import { locales, type Locale, defaultLocale } from "@/i18n";

export function generateStaticParams() {
  return locales.map((locale) => ({ locale }));
}

export default function LocaleLayout({
  children,
  params,
}: {
  children: React.ReactNode;
  params: { locale: Locale };
}) {
  const locale = locales.includes(params.locale) ? params.locale : defaultLocale;

  return (
    <html lang={locale}>
      <body>{children}</body>
    </html>
  );
}
```

## 4. 页面：按 locale 预渲染 + 读取字典

`app/[locale]/page.tsx`

```tsx
import { locales, type Locale } from "@/i18n";
import { getMessages } from "@/lib/i18n";

export function generateStaticParams() {
  return locales.map((locale) => ({ locale }));
}

export default async function Page({ params }: { params: { locale: Locale } }) {
  const t = await getMessages(params.locale);
  return (
    <main>
      <h1>{t.home.title}</h1>
      <p>{t.home.subtitle}</p>
    </main>
  );
}
```

其他子页面（如 `about/page.tsx`）同理：同样通过 `params.locale` 加载对应字典；通常也加 `generateStaticParams()`（或依赖父 segment 的 params 机制，但为确保静态导出稳定，显式加更稳妥）。

## 5. 开启静态导出

`next.config.js`

```javascript
/** @type {import('next').NextConfig} */
module.exports = {
  output: "export",
};
```

**构建命令**：

```bash
next build
```

**产物目录**：`out/`

## 约束/注意

- 静态导出模式下，不要用 **请求头** / `cookies()` / `headers()` 来判定语言；用 URL segment `[locale]`。
- 内部链接要带 locale（可封装 `localePath()` 或自定义 Link）。
- 字典建议按语言拆文件（JSON/TS 均可），页面只通过 `getMessages(locale)` 取值。
